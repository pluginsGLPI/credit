{% import "components/form/fields_macros.html.twig" as fields %}

<div name="credit_consume">

    <div class="hr-text mt-2">
        <i class="fa-2x ti ti-coin"></i>
        <span>{{ type_name }}</span>
    </div>

    {{ fields.sliderField(
        'plugin_credit_consumed_voucher',
        consume,
        __('Consume a voucher ?', 'credit'),
    ) }}

    {{ fields.dropdownField(
        creditentityclass,
        'plugin_credit_entities_id',
        default_credit,
        __('Voucher name', 'credit'),
        {
            'entity': entity_id,
            'condition': condition,
            'on_change': 'getQuantityRemaining' ~ rand ~ '(this.value);',
        }
    ) }}

    <div class="quantity">
        {{ fields.numberField(
            'plugin_credit_quantity',
            0,
            __('Quantity consumed', 'credit'),
            {
                'entity': entity_id,
                'condition': condition,
                'max': default_credit_max,
                'min': 0,
                'helper': __('Maximum consumable quantity', 'credit') ~ ' : <b>' ~ default_credit_max,
            }
        ) }}
    </div>

    <script>
        function getQuantityRemaining{{ rand }}(val) {
            quantity = document.querySelector('[id*="plugin-credit-quantity"]');
            quantity_label = document.querySelector('[for*="plugin-credit-quantity"]');
            console.log('val')
            if (val == 0) {
                document.querySelector('.quantity').style.display = 'none';
                quantity.max = 0;
                quantity.value = 0;
                quantity_label.querySelector('span.form-help').setAttribute('data-bs-content', __('Maximum consumable quantity', 'credit') + ' : 0 ');
            } else {
                document.querySelector('.quantity').style.display = 'block';
                $.ajax({
                    type: 'POST',
                    url: '{{ path('plugins/credit/ajax/dropdownQuantity.php') }}',
                    data: {
                        entity: val,
                    }
                }).done(function (data) {
                    quantity.max = data;
                    quantity.value = 0;
                    quantity_label.querySelector('span.form-help').setAttribute('data-bs-content', __('Maximum consumable quantity', 'credit') + ' : <b>' + data);
                });
            }
        }
    </script>
</div>
